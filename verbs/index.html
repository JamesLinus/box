<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Verb Reference - Box - A Next-Generation Builder for Docker Images</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Verb Reference";
    var mkdocs_page_input_path = "verbs.md";
    var mkdocs_page_url = "/verbs/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Box - A Next-Generation Builder for Docker Images</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Verb Reference</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#set95exec">set_exec</a></li>
                
            
                <li class="toctree-l3"><a href="#workdir">workdir</a></li>
                
            
                <li class="toctree-l3"><a href="#user">user</a></li>
                
            
                <li class="toctree-l3"><a href="#flatten">flatten</a></li>
                
            
                <li class="toctree-l3"><a href="#tag">tag</a></li>
                
            
                <li class="toctree-l3"><a href="#entrypoint">entrypoint</a></li>
                
            
                <li class="toctree-l3"><a href="#from">from</a></li>
                
            
                <li class="toctree-l3"><a href="#run">run</a></li>
                
            
                <li class="toctree-l3"><a href="#with95user">with_user</a></li>
                
            
                <li class="toctree-l3"><a href="#inside">inside</a></li>
                
            
                <li class="toctree-l3"><a href="#env">env</a></li>
                
            
                <li class="toctree-l3"><a href="#cmd">cmd</a></li>
                
            
                <li class="toctree-l3"><a href="#copy">copy</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../functions/">Function Reference</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Box - A Next-Generation Builder for Docker Images</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Verb Reference</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/erikh/box" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Verbs take action on a container and usually create a layer. Some commands can
be used to move data into and out of containers, or set properties and run
commands.</p>
<h2 id="set95exec">set_exec</h2>
<p><code>set_exec</code> sets both the entrypoint and cmd at the same time, allowing for no
race between the operations.</p>
<p><code>set_exec</code> takes a dictionary consisting of two known elements as symbols:
entrypoint and cmd. They each take a string array which is then propagated
to the respective properties in the container's configuration.</p>
<p>This command does not modify the entrypoint or cmd for <code>run</code> operations.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# this sets the what will be run with `/bin/echo foo`
set_exec entrypoint: [&quot;/bin/echo&quot;], cmd: [&quot;foo&quot;]
</code></pre>

<h2 id="workdir">workdir</h2>
<p>workdir sets the WorkingDir in the docker environment. It sets this
throughout the image creation; all run/copy statements will respect this
value. If you wish to break out or work within it further, look at the
<code>inside</code> call.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# each container that runs this image without the `-w` flag will start as
# `/test` for the current working directory.
workdir '/test'
</code></pre>

<h2 id="user">user</h2>
<p>user sets the username this container will use by default. It also affects
following run statements (but not copy, which always copies as root
currently). If you wish to switch to a user temporarily, consider using
<code>with_user</code>.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# all containers started with this image will use user `foo`
# %q[] just means, &quot;quote this as a string without interpolation&quot;
user %q[foo]
</code></pre>

<h2 id="flatten">flatten</h2>
<p>flatten requires no argumemnts and flattens all layers and commits a new
layer. This is useful for reducing the size of images or making them easier
to distribute.</p>
<p>NOTE: flattening will always bust the build cache.</p>
<p>NOTE: flattening requires downloading the image and re-uploading it. This
can take a lot of time over remote connections and is not advised.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# create some layers
run &quot;true&quot;
copy &quot;.&quot;, &quot;/test&quot;
flatten # image is shrunk to one layer here
tag &quot;erikh/test&quot;
</code></pre>

<h2 id="tag">tag</h2>
<p>tag tags an image within the docker daemon, named after the string provided.
It must be a valid tag name.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
run &quot;true&quot; # create a layer
tag &quot;erikh/true&quot; # tag the latest image as &quot;erikh/true&quot;
</code></pre>

<h2 id="entrypoint">entrypoint</h2>
<p>entrypoint sets the entrypoint for the image at runtime. It will not be
used for run invocations. Note that setting this clears any previously set cmd.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
entrypoint &quot;/bin/echo&quot; # all `docker run` commands will be preceded by this
cmd &quot;foo&quot;              # this will equate to `/bin/echo foo`
</code></pre>

<h2 id="from">from</h2>
<p>from sets the initial image and if necessary, pulls it from the registry. It
also sets the initial layer and must be called before several operations.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
</code></pre>

<p>or other images with full tags:</p>
<pre><code class="ruby">from &quot;ceph/rbd:latest&quot;
</code></pre>

<p>or fully qualified image IDs.</p>
<pre><code class="ruby"># sha256s are longer than this normally.
from &quot;sha256:deadbeefcafebabeaddedbeef&quot;
</code></pre>

<h2 id="run">run</h2>
<p>run runs a command provided as a string, and saves the layer.</p>
<p>It respects user and workdir, but not entrypoint and command. It does this
so it can respect the values provided in the script instead of what was
intended for the final image.</p>
<p>Cache keys are generated based on the command name, so to be certain your
command is run in the event of it hitting cache, run box with NO_CACHE=1.</p>
<p>Examples:</p>
<p>Create a file called <code>/bar</code> inside the container, then chown it to nobody. Run
commands don't need a lot of <code>&amp;&amp;</code> because you can trivially flatten the layers.</p>
<p>Run does not accept the exec-form from docker's RUN equivalent. Everything RUN
processes goes through <code>/bin/sh -c</code>.</p>
<pre><code class="ruby">from &quot;debian&quot;
run &quot;echo foo &gt;/bar&quot;
run &quot;chown nobody:nogroup /bar&quot;
</code></pre>

<p>Run in the context of a specific user or workdir. This allows us to finely
control our run invocations and further processing after the container image
has been run.</p>
<pre><code class="ruby">from &quot;debian&quot;

with_user &quot;nobody&quot; do # just the commands inside this block will run as `nobody`
  run &quot;echo foo &gt;/tmp/bar&quot;
end

# notice how we are still root
run &quot;useradd -s /bin/sh -m -d /home/erikh erikh&quot;

# all commands from here on will run as `erikh`, overriden only by `with_user`
# and other `user` calls.
user &quot;erikh&quot;
run &quot;echo foo &gt;/tmp/erikh-file&quot;

# set the workdir temporarily for the commands within the block.
# this will create /tmp/another-file-in-tmp.
inside &quot;/tmp&quot; do
  run &quot;echo foo &gt;another-file-in-tmp&quot;
end

# this behaves exactly like user, just setting the default cwd instead:
# creates /tmp/yet-another-file
workdir &quot;/tmp&quot;
run &quot;echo foo &gt;yet-another-file&quot;
</code></pre>

<h2 id="with95user">with_user</h2>
<p><code>with_user</code>, when provided with a string username and block invokes commands
within the user's login context. Unfortunately, copy does not respect this
yet. It does not affect the final image.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

with_user &quot;nobody&quot; do
  run &quot;whoami&quot; # i am nobody!
end
</code></pre>

<h2 id="inside">inside</h2>
<p>inside, when provided with a directory name string and block, invokes
commands within the context of the working directory being set to the
string. It does not affect the final image.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

inside &quot;/dev&quot; do
  run &quot;mknod webscale c 1 3&quot;
end
</code></pre>

<h2 id="env">env</h2>
<p>env, when provided with a hash of string =&gt; string key/value combinations,
will set the environment in the image and future run invocations.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

env &quot;GOPATH&quot; =&gt; &quot;/go&quot;, &quot;PATH&quot; =&gt; &quot;/usr/bin:/bin&quot;
env GOPATH: &quot;/go&quot;, PATH: &quot;/usr/bin:/bin&quot; # equivalent if you prefer this syntax
</code></pre>

<h2 id="cmd">cmd</h2>
<p>cmd, when provided with a string will set the docker image's Cmd property,
which are the arguments that follow the entrypoint (and are overridden when
you provide a command to <code>docker run</code>). It does not affect run invocations.</p>
<p>Note that if you set this before entrypoint, it will be cleared.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# entrypoint is `/bin/sh -c` by default, so we will just run whatever command
# is thrown at us. This image will run `ls` in the workdir by default.
cmd &quot;ls&quot;
</code></pre>

<h2 id="copy">copy</h2>
<p>copy copies files from the host to the container. It only works relative to
the current directory. The build cache is calculated by summing the tar
result of edited files. Since mtime is also considered, changes to that will
also bust the cache.</p>
<p>NOTE: copy does not respect user permissions when the <code>user</code> or <code>with_user</code>
modifiers are applied. This will be fixed eventually.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

# recursively copies everything the cwd to test, which is relative to the
# workdir inside the container (`/` by default).
copy &quot;.&quot;, &quot;/test&quot;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../functions/" class="btn btn-neutral float-right" title="Function Reference">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/erikh/box" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../functions/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
