<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Box - Flexible Docker Builder</title>
  

  <link rel="shortcut icon" href="./img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "None";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script>
  <script src="./js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> Box - Flexible Docker Builder</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">Introduction</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#getting-box">Getting Box</a></li>
                
            
                <li class="toctree-l3"><a href="#invocation">Invocation</a></li>
                
            
                <li class="toctree-l3"><a href="#making-box-scripts">Making Box Scripts</a></li>
                
            
                <li class="toctree-l3"><a href="#example-box-script">Example Box Script</a></li>
                
                    <li><a class="toctree-l4" href="#the-build-cache">The Build Cache</a></li>
                
            
                <li class="toctree-l3"><a href="#example-box-script-advanced-version">Example Box Script (advanced version)</a></li>
                
            
                <li class="toctree-l3"><a href="#caveats">Caveats</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="verbs/">Verb Reference</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="functions/">Function Reference</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">Box - Flexible Docker Builder</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Introduction</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/erikh/box" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Box is a small utility for the building of docker images. Through use of mruby,
we provide additional flexibility over the vanilla <code>docker build</code> command by
adding control structures and basic predicates. We also add new verbs that
allow new actions, such as flattening and tagging images.</p>
<h2 id="getting-box">Getting Box</h2>
<p>That's complicated. You can either follow the <a href="https://github.com/erikh/box/blob/master/README.md">Development Instructions</a>
or you can pull <code>erikh/box:latest</code> for now. See <code>Invocation</code> for how to run it.</p>
<h2 id="invocation">Invocation</h2>
<p>The commandline tool <code>box</code> will either accept a file as a commandline argument:</p>
<pre><code class="shell">$ box myplan.rb
</code></pre>

<p>Or from stdin:</p>
<pre><code class="shell">$ box &lt; myplan.rb
</code></pre>

<p>The current working directory that Box runs in is very important, it is the
jumping-off point for most copy operations. If you run the <code>erikh/box</code>
container, you may wish to run it in this way:</p>
<pre><code class="shell">$ docker run -i -v $PWD:$PWD -v /var/run/docker.sock:/var/run/docker.sock -w $PWD erikh/box:latest &lt; myplan.rb
</code></pre>

<p>For additional flags and functionality, see the help:</p>
<pre><code class="shell">$ box --help
</code></pre>

<h2 id="making-box-scripts">Making Box Scripts</h2>
<p>Box scripts are written in mruby, an embedded, smaller variant of ruby. If you
are new to ruby, here is a tutorial that only <a href="https://github.com/jhotta/chef-fundamentals-ja/blob/master/slides/just-enough-ruby-for-chef/01_slide.md">covers the basics</a>.
You will not need to be an advanced ruby user to leverage Box.</p>
<p>Box script terms are either functions or verbs.</p>
<p>Verbs typically create a layer and are meant to run at the top level of the
script; they are not intended to return a sane value other than success/fail.
Operations like <code>run</code> and <code>copy</code> fit into the "verb" category. These are very
similar to the verbs you'd find in <code>docker build</code>.</p>
<p>Functions are unique to Box and allow you to pass data both from the image into
the build system and pass it to other calls, or just print it out for later
use. Functions like <code>getuid</code> exist to retrieve the UID of a user as the
container sees it, for the purposes of using it for future operations.</p>
<p>Please take a look at our <a href="./verbs">verbs reference</a> and <a href="./functions">functions
reference</a> for more information.</p>
<h2 id="example-box-script">Example Box Script</h2>
<p>Here's a basic example that downloads the newest (1.7.3) version of golang with
curl and unpacks it. If you set an environment variable called
<code>GO_VERSION</code>, it will use that version instead.</p>
<pre><code class="ruby">from &quot;debian&quot;

run &quot;apt-get update&quot;
run &quot;apt-get install curl -y&quot;

go_version = getenv(&quot;GO_VERSION&quot;)

if go_version.empty?
  go_version = &quot;1.7.3&quot;
end

url = &quot;https://storage.googleapis.com/golang/go#{go_version}.linux-amd64.tar.gz&quot;

run &quot;curl -sSL '#{url}' | tar -xvz -C /usr/local&quot;
</code></pre>

<h3 id="the-build-cache">The Build Cache</h3>
<p>The build cache is enabled by default. It is not an exact cache but constructs
the layer graph in a non-standard way using docker's image Comment field,
populating it with sums and command instructions in a very similar way that
<code>docker build</code> does.</p>
<p>If you find the behavior surprising, you can turn it off:</p>
<pre><code>$ box --no-cache myplan.rb
</code></pre>

<h2 id="example-box-script-advanced-version">Example Box Script (advanced version)</h2>
<p>This is the Box script we use to build Box itself. It uses many of its
features. Be sure to check the <a href="https://erikh.github.io/box/verbs/">verbs</a> to
refer to different constructs used in the file.</p>
<p>You can find the latest version of it
<a href="https://github.com/erikh/box/blob/master/build.rb">here</a> too.</p>
<pre><code class="ruby">from &quot;golang&quot;

packages = %w[
  build-essential
  g++
  git
  wget
  curl
  ruby
  bison
  flex
  iptables
  psmisc
]

run &quot;apt-get update&quot;
run &quot;apt-get install -y #{packages.join(&quot; &quot;)}&quot;
env &quot;GOPATH&quot; =&gt; &quot;/go&quot;

if getenv(&quot;RELEASE&quot;) == &quot;&quot;
  run &quot;wget https://get.docker.com/builds/Linux/x86_64/docker-1.12.1.tgz&quot;
  run &quot;tar -xpf docker-1.12.1.tgz --strip-components=1 -C /usr/bin/&quot;
  run &quot;rm docker-1.12.1.tgz&quot;
  copy &quot;dind&quot;, &quot;/dind&quot;
end

copy &quot;.&quot;, &quot;/go/src/github.com/erikh/box&quot;

if getenv(&quot;IGNORE_LIBMRUBY&quot;) == &quot;&quot;
  run &quot;cd /go/src/github.com/erikh/box &amp;&amp; make&quot;
end

if getenv(&quot;RELEASE&quot;) != &quot;&quot;
  run &quot;mv /go/bin/box /box&quot;
  set_exec entrypoint: [&quot;/box&quot;], cmd: []
  run &quot;apt-get purge -y #{packages.join(&quot; &quot;)}&quot;
  run &quot;apt-get autoclean&quot;
  run &quot;rm -rf /usr/local /go /var/cache/apt /var/lib/apt&quot;
  flatten
  tag &quot;erikh/box:latest&quot;
else
  workdir &quot;/go/src/github.com/erikh/box&quot;
  set_exec entrypoint: [&quot;/dind&quot;], cmd: [&quot;make&quot;, &quot;docker-test&quot;]
  tag &quot;box-test&quot;
end
</code></pre>

<h2 id="caveats">Caveats</h2>
<p>You can see <a href="https://github.com/erikh/box/issues">all of our issues</a> here.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="verbs/" class="btn btn-neutral float-right" title="Verb Reference">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/erikh/box" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
        <span style="margin-left: 15px"><a href="verbs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>

<!--
MkDocs version : 0.15.3
Build Date UTC : 2016-10-21 06:16:54.611445
-->
